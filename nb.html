<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tic Tac Toe</title>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/brython@3.9.5/brython.min.js"></script>
</head>
<body onload="brython()">

<h1 style="text-align: center;">Tic Tac Toe</h1>
<div style="text-align: center;">
    <canvas id="boardCanvas" width="300" height="300" style="border: 2px solid black;"></canvas>
</div>
<div style="text-align: center;">
    <p id="message"></p>
    <input type="text" id="moveInput" placeholder="Enter row and column (e.g., 1 3)">
    <button onclick="makeMove()">Make Move</button>
    <button onclick="restart()">Restart</button>
</div>

<script type="text/python">
from browser import document, html, alert, window

# Constants
BOARD_SIZE = 300
BOARD_ROWS, BOARD_COLS = 3, 3
CELL_SIZE = BOARD_SIZE // BOARD_ROWS

# Board
board = [[" "] * BOARD_COLS for _ in range(BOARD_ROWS)]

# Canvas setup
canvas = document["boardCanvas"]
ctx = canvas.getContext("2d")

def draw_board():
    ctx.clearRect(0, 0, BOARD_SIZE, BOARD_SIZE)
    ctx.beginPath()

    # Draw horizontal lines
    for i in range(1, BOARD_ROWS):
        ctx.moveTo(0, i * CELL_SIZE)
        ctx.lineTo(BOARD_SIZE, i * CELL_SIZE)

    # Draw vertical lines
    for i in range(1, BOARD_COLS):
        ctx.moveTo(i * CELL_SIZE, 0)
        ctx.lineTo(i * CELL_SIZE, BOARD_SIZE)

    ctx.lineWidth = 2
    ctx.strokeStyle = "black"
    ctx.stroke()

def draw_symbols():
    for row in range(BOARD_ROWS):
        for col in range(BOARD_COLS):
            symbol = board[row][col]
            if symbol == 'X':
                draw_x(row, col)
            elif symbol == 'O':
                draw_o(row, col)

def draw_x(row, col):
    ctx.beginPath()
    startX = col * CELL_SIZE + CELL_SIZE // 6
    startY = row * CELL_SIZE + CELL_SIZE // 6
    endX = (col + 1) * CELL_SIZE - CELL_SIZE // 6
    endY = (row + 1) * CELL_SIZE - CELL_SIZE // 6
    ctx.moveTo(startX, startY)
    ctx.lineTo(endX, endY)
    ctx.moveTo(startX, endY)
    ctx.lineTo(endX, startY)
    ctx.lineWidth = 5
    ctx.strokeStyle = "red"
    ctx.stroke()

def draw_o(row, col):
    centerX = col * CELL_SIZE + CELL_SIZE // 2
    centerY = row * CELL_SIZE + CELL_SIZE // 2
    radius = CELL_SIZE // 3
    ctx.beginPath()
    ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI)
    ctx.lineWidth = 5
    ctx.strokeStyle = "blue"
    ctx.stroke()

def print_message(msg):
    document["message"].text = msg

def check_winner(player):
    for row in range(BOARD_ROWS):
        if all(s == player for s in board[row]):
            return True
    for col in range(BOARD_COLS):
        if all(board[row][col] == player for row in range(BOARD_ROWS)):
            return True
    if all(board[i][i] == player for i in range(BOARD_ROWS)) or all(board[i][BOARD_ROWS-1-i] == player for i in range(BOARD_ROWS)):
        return True
    return False

def is_full():
    return all(all(cell != " " for cell in row) for row in board)

def minimax(board, depth, is_maximizing):
    if check_winner('X'):
        return -1
    if check_winner('O'):
        return 1
    if is_full():
        return 0
    
    if is_maximizing:
        best_score = -float('inf')
        for row in range(BOARD_ROWS):
            for col in range(BOARD_COLS):
                if board[row][col] == " ":
                    board[row][col] = 'O'
                    score = minimax(board, depth + 1, False)
                    board[row][col] = " "
                    best_score = max(score, best_score)
        return best_score
    else:
        best_score = float('inf')
        for row in range(BOARD_ROWS):
            for col in range(BOARD_COLS):
                if board[row][col] == " ":
                    board[row][col] = 'X'
                    score = minimax(board, depth + 1, True)
                    board[row][col] = " "
                    best_score = min(score, best_score)
        return best_score

def best_move():
    best_score = -float('inf')
    move = None
    for row in range(BOARD_ROWS):
        for col in range(BOARD_COLS):
            if board[row][col] == " ":
                board[row][col] = 'O'
                score = minimax(board, 0, False)
                board[row][col] = " "
                if score > best_score:
                    best_score = score
                    move = (row, col)
    return move

def makeMove():
    move_input = document["moveInput"].value.strip()
    if not move_input:
        alert("Please enter a move.")
        return
    try:
        row, col = map(int, move_input.split())
        row -= 1
        col -= 1
        if board[row][col] != " ":
            alert("Invalid move! Cell already taken.")
            return
    except:
        alert("Invalid input! Please enter row and column as numbers.")
        return

    board[row][col] = 'X'
    draw_board()
    draw_symbols()

    if check_winner('X'):
        print_message("You win!")
        return
    if is_full():
        print_message("Draw!")
        return

    move = best_move()
    if move:
        board[move[0]][move[1]] = 'O'
    else:
        print_message("Draw!")
        return

    draw_board()
    draw_symbols()

    if check_winner('O'):
        print_message("Computer wins!")
    elif is_full():
        print_message("Draw!")

def restart():
    global board
    board = [[" "] * BOARD_COLS for _ in range(BOARD_ROWS)]
    ctx.clearRect(0, 0, BOARD_SIZE, BOARD_SIZE)
    draw_board()
    print_message("")

draw_board()
print_message("")
</script>

</body>
</html>
